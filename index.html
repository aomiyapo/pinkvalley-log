<div id="log"></div>

<script>
const logDiv = document.getElementById('log');

// ====== Сюжетные строки (50) ======
const lines = [
"|~USER_ID           : 01~|",
"|~PROFILE_STATE     : RUNNING..~|",
"|~RESPIRATION       : [ON]~|",
"|~OXYGEN_LEVEL      : 98%~|",
"|~HEART_RATE        : 72 BPM~|",
"|~LOCATION          : UNKNOWN~|",
"|~LOCATION_UPDATE   : SUPERMARKET~|",
"|~LIGHTING_STATUS   : FLICKERING~|",
"|~AUDIO_INPUT       : DISTANT HUM~|",
"|~ENTITY_SCAN       : NEGATIVE~|",
"|~AISLE_03_STATUS   : EMPTY~|",
"|~AISLE_07_STATUS   : PRODUCT_DISPLACED~|",
"|~FREEZER_TEMP      : -12C~|",
"|~OXYGEN_LEVEL      : 95%~|",
"|~NOISE_SOURCE      : UNKNOWN~|",
"|~ENTITY_SCAN       : POSITIVE~|",
"|~ENTITY_DISTANCE   : 24m~|",
"|~ENTITY_DISTANCE   : 18m~|",
"|~ENTITY_DISTANCE   : 11m~|",
"|~HEART_RATE        : 103 BPM~|",
"|~ESCAPE_ROUTE      : BLOCKED~|",
"|~DOOR_ACCESS       : DENIED~|",
"|~AUDIO_FEEDBACK    : STATIC~|",
"|~LOCATION_UPDATE   : TILE_CORRIDOR~|",
"|~CORRIDOR_LENGTH   : EXTENDED~|",
"|~LIGHTING_STATUS   : DIM~|",
"|~WALL_PATTERN      : REPEATING~|",
"|~ENTITY_SCAN       : LOST_SIGNAL~|",
"|~FOOTSTEP_AUDIO    : ECHO~|",
"|~HEART_RATE        : 119 BPM~|",
"|~SYSTEM_GLITCH     : TRUE~|",
"|~TEXTURE_ERROR     : CODE_441~|",
"|~CORRIDOR_END      : NOT_FOUND~|",
"|~CORRIDOR_END      : NOT_FOUND~|",
"|~LOCATION_UPDATE   : SCHOOL_BUILDING~|",
"|~ROOM_ID           : CLASSROOM_04~|",
"|~BOARD_TEXT        : UNREADABLE~|",
"|~DESK_COUNT        : 19~|",
"|~STUDENT_STATUS    : NONE_PRESENT~|",
"|~ENTITY_SCAN       : POSITIVE~|",
"|~ENTITY_ID         : TILIN~|",
"|~ENTITY_BEHAVIOR   : STATIONARY~|",
"|~ENTITY_HEAD_ROT   : 180_DEG~|",
"|~AUDIO_INPUT       : BREATHING~|",
"|~HEART_RATE        : 137 BPM~|",
"|~ESCAPE_ROUTE      : DOOR_OPEN~|",
"|~LOCATION_UPDATE   : SHOWER_ROOM~|",
"|~WATER_FLOW        : ACTIVE~|",
"|~TEMPERATURE       : 41C~|",
"|~FLOOR_STATUS      : WET~|",
"|~REFLECTION_STATUS : DISTORTED~|",
"|~ENTITY_REFLECTION : PRESENT~|"
];

// ====== ENTRY Логи ======
for(let i=1;i<=700;i++){
  lines.push(`|~SYSTEM_LOG_ENTRY_${i} : ACTIVE~|`);
}

let i = 0;
let failurePhase = false;

// параметры блоков ошибок
const errorBlocks = [
  {size:5, pause:1500},
  {size:7, pause:2000},
  {size:4, pause:1000},
  {size:6, pause:1800},
];

let currentBlock = 0;
let inBlock = false;
let blockLinesLeft = 0;

function showLine() {
  if(i >= lines.length) return;

  const lineEl = document.createElement('div');
  lineEl.className = 'line';

  // включаем фазу SYSTEM FAILURE после 900 строки
  if(i >= 900 && !failurePhase){
    failurePhase = true;
    document.body.classList.add("failure");
    inBlock = true;
    blockLinesLeft = errorBlocks[currentBlock].size;
  }

  if(failurePhase && inBlock){
    // блок ошибок
    lineEl.textContent = `|~CRITICAL_SYSTEM_FAILURE : CODE_${Math.floor(Math.random()*9999)}~|`;
    lineEl.classList.add('error');
    lineEl.style.position = "relative";
    lineEl.style.left = `${Math.random()*20-10}px`;
    lineEl.style.top  = `${Math.random()*10-5}px`;
    blockLinesLeft--;
    if(blockLinesLeft <= 0){
      inBlock = false;
      currentBlock++;
    }
  } else {
    // обычные строки + случайные ошибки
    if(failurePhase && Math.random()<0.2){
      lineEl.textContent = `|~ERROR_UNKNOWN : CODE_${Math.floor(Math.random()*999)}~|`;
      lineEl.classList.add('error');
    } else {
      lineEl.textContent = lines[i];
    }
  }

  logDiv.appendChild(lineEl);
  logDiv.scrollTop = logDiv.scrollHeight;
  setTimeout(()=>{lineEl.style.opacity=1;},5);

  i++;

  // ===== задержка =====
  let delay;
  if(failurePhase){
    if(inBlock){
      delay = 20; // быстрые строки блока ошибок
    } else if(currentBlock < errorBlocks.length){
      delay = errorBlocks[currentBlock].pause; // пауза между блоками
      inBlock = true;
      blockLinesLeft = errorBlocks[currentBlock].size;
    } else {
      delay = 5; // финальная фаза — почти мгновенно
    }
  } else if(i > 50){ // ENTRY лог
    delay = 20 + Math.random()*40;
  } else {
    delay = 200; // сюжетные строки
  }

  setTimeout(showLine, delay);
}

showLine();
</script>

<style>
body{
  background:black;
  color:#ff69b4; /* светло-розовый текст */
  font-family:monospace;
  margin:0;
  padding:20px;
  overflow:hidden;
}

#log{
  height:100vh;
  overflow-y:auto;
}

.line{
  opacity:0;
  transition:opacity 0.1s, transform 0.05s;
  margin-bottom:2px;
}

.error{
  color:#ff1493; /* темно-розовый для ошибок */
  font-weight:bold;
}

.failure{
  animation: glitch 2s infinite;
}

@keyframes glitch{
  0%{background-color:black;}
  50%{background-color:#2b001f;} /* медленно мигающий темно-розовый фон */
  100%{background-color:black;}
}
</style>